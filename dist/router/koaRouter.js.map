{"version":3,"sources":["../../router/koaRouter.js"],"names":["fs","require","Router","httpHandle","koaBody","render","page","Promise","resolve","reject","viewUrl","readFile","err","data","api","get","post","put","del","common","ctx","body","router","use","routes","allowedMethods","module","exports"],"mappings":";;;;AAAA;;;AAGA,IAAMA,KAAKC,QAAQ,IAAR,CAAX;AACA,IAAMC,SAASD,QAAQ,YAAR,CAAf;;eACmBA,QAAQ,8BAAR,C;IAAZE,U,YAAAA,U;;AACP,IAAMC,UAAUH,QAAQ,UAAR,GAAhB;;AAEA,IAAMI,SAAS,SAATA,MAAS,CAACC,IAAD,EAAU;AACrB,WAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,YAAIC,sBAAoBJ,IAAxB;AACAN,WAAGW,QAAH,CAAYD,OAAZ,EAAqB,QAArB,EAA+B,UAACE,GAAD,EAAMC,IAAN,EAAe;AAC1C,gBAAID,GAAJ,EAAS;AACLH,uBAAOG,GAAP;AACH,aAFD,MAEO;AACHJ,wBAAQK,IAAR;AACH;AACJ,SAND;AAOH,KATM,CAAP;AAUH,CAXD;;AAaA,IAAIC,MAAM,IAAIZ,MAAJ,EAAV;;AAEAY,IAAIC,GAAJ,CAAQ,GAAR,EAAaZ,UAAb,EACKa,IADL,CACU,GADV,EACeZ,OADf,EACwBD,UADxB,EAEKc,GAFL,CAES,GAFT,EAEcb,OAFd,EAEuBD,UAFvB,EAEmCe,GAFnC,CAEuC,GAFvC,EAE4Cd,OAF5C,EAEqDD,UAFrD;;AAIA,IAAIgB,SAAS,IAAIjB,MAAJ,EAAb;AACAiB,OAAOJ,GAAP,CAAW,GAAX;AAAA,uEAAgB,iBAAMK,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BACKf,OAAO,YAAP,CADL;;AAAA;AACZe,4BAAIC,IADQ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAhB;;AAAA;AAAA;AAAA;AAAA;;AAIA,IAAIC,SAAS,IAAIpB,MAAJ,EAAb;AACAoB,OAAOC,GAAP,CAAW,MAAX,EAAmBT,IAAIU,MAAJ,EAAnB,EAAiCV,IAAIW,cAAJ,EAAjC;AACAH,OAAOC,GAAP,CAAW,GAAX,EAAgBJ,OAAOK,MAAP,EAAhB,EAAiCL,OAAOM,cAAP,EAAjC;;AAGAC,OAAOC,OAAP,GAAiBL,MAAjB","file":"koaRouter.js","sourcesContent":["/**\r\n * Created by AllenFeng on 2017/8/29.\r\n */\r\nconst fs = require('fs')\r\nconst Router = require('koa-router');\r\nconst {httpHandle}=require('../Infrastructure/httpHandle');\r\nconst koaBody = require('koa-body')();\r\n\r\nconst render = (page) => {\r\n    return new Promise((resolve, reject) => {\r\n        let viewUrl = `./view/${page}`\r\n        fs.readFile(viewUrl, \"binary\", (err, data) => {\r\n            if (err) {\r\n                reject(err)\r\n            } else {\r\n                resolve(data)\r\n            }\r\n        })\r\n    })\r\n}\r\n\r\nlet api = new Router();\r\n\r\napi.get('*', httpHandle)\r\n    .post('*', koaBody, httpHandle)\r\n    .put('*', koaBody, httpHandle).del('*', koaBody, httpHandle);\r\n\r\nlet common = new Router();\r\ncommon.get('*', async(ctx) => {\r\n    ctx.body = await render('index.html');\r\n})\r\n\r\nlet router = new Router();\r\nrouter.use('/app', api.routes(), api.allowedMethods());\r\nrouter.use('/', common.routes(), common.allowedMethods());\r\n\r\n\r\nmodule.exports = router;\r\n\r\n\r\n\r\n"]}
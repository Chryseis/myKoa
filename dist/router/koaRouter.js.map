{"version":3,"sources":["../../router/koaRouter.js"],"names":["fs","require","Router","appData","httpHandle","koaBody","multipart","strict","render","page","Promise","resolve","reject","viewUrl","readFile","err","data","api","get","ctx","body","errno","goods","seller","ratings","common","router","use","routes","allowedMethods","module","exports"],"mappings":";;;;AAAA;;;AAGA,IAAMA,KAAKC,QAAQ,IAAR,CAAX;AACA,IAAMC,SAASD,QAAQ,YAAR,CAAf;AACA,IAAME,UAAUF,QAAQ,mBAAR,CAAhB;;eACqBA,QAAQ,8BAAR,C;IAAdG,U,YAAAA,U;;AACP,IAAMC,UAAUJ,QAAQ,UAAR,EAAoB;AAChCK,eAAW,IADqB;AAEhCC,YAAO;AAFyB,CAApB,CAAhB;;AAKA;AACA;;AAEA,IAAMC,SAAS,SAATA,MAAS,CAACC,IAAD,EAAU;AACrB,WAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,YAAIC,sBAAoBJ,IAAxB;AACAT,WAAGc,QAAH,CAAYD,OAAZ,EAAqB,QAArB,EAA+B,UAACE,GAAD,EAAMC,IAAN,EAAe;AAC1C,gBAAID,GAAJ,EAAS;AACLH,uBAAOG,GAAP;AACH,aAFD,MAEO;AACHJ,wBAAQK,IAAR;AACH;AACJ,SAND;AAOH,KATM,CAAP;AAUH,CAXD;;AAaA,IAAIC,MAAM,IAAIf,MAAJ,EAAV;;AAEA;AACA;AACA;;AAEAe,IAAIC,GAAJ,CAAQ,QAAR;AAAA,uEAAkB,iBAAMC,GAAN;AAAA;AAAA;AAAA;AAAA;AACdA,4BAAIC,IAAJ,GAAU;AACNC,mCAAO,CADD;AAENL,kCAAMb,QAAQmB;AAFR,yBAAV;;AADc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAlB;;AAAA;AAAA;AAAA;AAAA,KAKGJ,GALH,CAKO,SALP;AAAA,wEAKkB,kBAAMC,GAAN;AAAA;AAAA;AAAA;AAAA;AACdA,4BAAIC,IAAJ,GAAW;AACPC,mCAAO,CADA;AAEPL,kCAAMb,QAAQoB;AAFP,yBAAX;;AADc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KALlB;;AAAA;AAAA;AAAA;AAAA,KAUGL,GAVH,CAUO,UAVP;AAAA,wEAUmB,kBAAMC,GAAN;AAAA;AAAA;AAAA;AAAA;AACfA,4BAAIC,IAAJ,GAAY;AACRC,mCAAO,CADC;AAERL,kCAAMb,QAAQqB;AAFN,yBAAZ;;AADe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAVnB;;AAAA;AAAA;AAAA;AAAA;;AAiBA,IAAIC,SAAS,IAAIvB,MAAJ,EAAb;AACAuB,OAAOP,GAAP,CAAW,GAAX;AAAA,wEAAgB,kBAAMC,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BACKX,OAAO,YAAP,CADL;;AAAA;AACZW,4BAAIC,IADQ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAhB;;AAAA;AAAA;AAAA;AAAA;;AAIA,IAAIM,SAAS,IAAIxB,MAAJ,EAAb;AACAwB,OAAOC,GAAP,CAAW,MAAX,EAAmBV,IAAIW,MAAJ,EAAnB,EAAiCX,IAAIY,cAAJ,EAAjC;AACAH,OAAOC,GAAP,CAAW,GAAX,EAAgBF,OAAOG,MAAP,EAAhB,EAAiCH,OAAOI,cAAP,EAAjC;;AAGAC,OAAOC,OAAP,GAAiBL,MAAjB","file":"koaRouter.js","sourcesContent":["/**\r\n * Created by AllenFeng on 2017/8/29.\r\n */\r\nconst fs = require('fs')\r\nconst Router = require('koa-router');\r\nconst appData = require('../data/data.json')\r\nconst {httpHandle} = require('../Infrastructure/httpHandle');\r\nconst koaBody = require('koa-body')({\r\n    multipart :true,\r\n    strict:false\r\n});\r\n\r\n//const body=require('koa-better-body')();\r\n//const body = require('koa-better-body')();\r\n\r\nconst render = (page) => {\r\n    return new Promise((resolve, reject) => {\r\n        let viewUrl = `./view/${page}`\r\n        fs.readFile(viewUrl, \"binary\", (err, data) => {\r\n            if (err) {\r\n                reject(err)\r\n            } else {\r\n                resolve(data)\r\n            }\r\n        })\r\n    })\r\n}\r\n\r\nlet api = new Router();\r\n\r\n// api.get('*', httpHandle)\r\n//     .post('*',koaBody, httpHandle)\r\n//     .put('*',koaBody, httpHandle).del('*',koaBody, httpHandle);\r\n\r\napi.get('/goods', async(ctx) => {\r\n    ctx.body ={\r\n        errno: 0,\r\n        data: appData.goods\r\n    }\r\n}).get('/seller', async(ctx) => {\r\n    ctx.body = {\r\n        errno: 0,\r\n        data: appData.seller\r\n    }\r\n}).get('/ratings', async(ctx) => {\r\n    ctx.body =  {\r\n        errno: 0,\r\n        data: appData.ratings\r\n    }\r\n})\r\n\r\nlet common = new Router();\r\ncommon.get('*', async(ctx) => {\r\n    ctx.body = await render('index.html');\r\n})\r\n\r\nlet router = new Router();\r\nrouter.use('/api', api.routes(), api.allowedMethods());\r\nrouter.use('/', common.routes(), common.allowedMethods());\r\n\r\n\r\nmodule.exports = router;\r\n\r\n\r\n\r\n"]}